<div class="combobox-container">
     <input #inputEl type="text" [value]="displayValue()" (focus)="open()" (input)="onInput($event)" (keydown)="onKeydown($event)" [placeholder]="placeholder()" class="combobox-input" autocomplete="off" />

     <button type="button" (click)="toggle()" class="combobox-toggle">
          <lucide-icon name="chevron-down" size="18"></lucide-icon>
     </button>
</div>

<!-- Register template portal -->
<ng-template #dropdown let-data>
     <div class="combobox-wrapper-stop">
          <div class="combobox-dropdown-overlay">
               @if (filteredItems().length === 0) {
               <div class="combobox-empty">{{ emptyMessage() }}</div>
               } @for (item of filteredItems(); track item.id; let i = $index) {
               <!-- Group Header - only show if group changes or first item -->
               @if (i === 0 || item.group !== (filteredItems()[i - 1]?.group ?? null)) {
               <div class="combobox-group-header">{{ item.group || '' }}</div>
               }

               <!-- Item -->
               <div class="combobox-item" [class.highlighted]="highlightedIndex() === i || item.id === value()?.id" [class.current-account]="item.isCurrentAccount" [class.current-code]="item.isCurrentCode" [class.current-token]="item.isCurrentToken" (click)="(item.isCurrentAccount || item.isCurrentCode || item.isCurrentToken) ? null : onSelect(item)">
                    <div class="item-name">
                         {{ item.display }} @if (item.isCurrentAccount) {
                         <span class="current-account-badge">Current Account</span>
                         } @if (item.isCurrentCode) {
                         <span class="current-code-badge">Current Code</span>
                         } @if (item.isCurrentToken) {
                         <span class="current-token-badge">Selected</span>
                         } @if (item.pending) {
                         <span class="ml-2 text-xs bg-orange-100 text-orange-800 px-2 py-0.5 rounded-full">Pending</span>
                         }
                    </div>

                    @if (item.secondary) {
                    <div class="item-address">{{ item.secondary }}</div>
                    }
               </div>
               }
          </div>
     </div>
</ng-template>
